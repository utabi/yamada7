# Agents Overview

`yamada7`のフィードバックループに登場する主要エージェントとその責務を整理する。

## 1. Core Thinker (LLM)

- **役割**: 状態評価、計画立案、リスク解析、反省ログ生成。  
- **入力**: 状態要約、候補アクション、報酬スキーマ、記憶抜粋（恐怖辞典・探索ログ）。  
- **出力**: 目的とサブゴール、行動列、期待報酬・危険度、反省と改訂方針。  
- **備考**: 出力は構造化テキスト（例: YAML 風）を想定。トークン節約のためテンプレート化する。

## 2. State Formatter

- **役割**: 環境APIから得た生データをLLM向けのコンパクトな記述に変換。  
- **入力**: 観測 JSON、記憶モジュールからの参照リクエスト。  
- **出力**: テンプレート化された状態要約（例: 現在地、残ライフ、危険指標、未知度、重要イベント）。  
- **備考**: トークン数が閾値を超える場合は優先度付きサマリを生成。

## 3. Result Formatter

- **役割**: 行動後の結果・報酬・副作用を整理し、反省フェーズ用のレポートを作成。  
- **入力**: 実行エンジンのログ、環境APIからのフィードバック。  
- **出力**: 実績報酬、被ダメージ、得た情報量、未解決リスク、失敗イベント。

## 4. Execution Engine

- **役割**: LLMが提示した行動列を検証し、ホワイトリスト化されたコマンドにマッピングして実行。  
- **入力**: 行動列（操作タイプ、対象、パラメータ）。  
- **出力**: 実行ステータス、エラー、即時リスクフラグ。  
- **備考**: 危険閾値超過時には自動的に緊急停止や回避アクションをトリガーする。

## 5. Memory Manager

- **役割**: 恐怖辞典・探索ログ・メタノートなどの長期記憶の管理。  
- **入力**: 反省ログ、実行結果、環境メタデータ。  
- **出力**: LLM向け抜粋、要約、頻出パターン分析。  
- **備考**: 外部ストレージに保存し、ターンごとに関連度の高いチャンクのみ渡す。

## 6. Reward Synthesizer

- **役割**: 外部報酬と内部報酬を統合し、LLMに提示できるスコアボードを生成。  
- **入力**: 生存指標（ライフ、ターン数）、資源値、探索メトリクス、危険予測精度。  
- **出力**: スコア表、トレードオフ警告、報酬トレンド（移動平均など）。  
- **備考**: 好奇心ボーナスと生存コストのバランスを動的調整する係数を保持する。

## 7. Dashboard Presenter

- **役割**: 複数エージェントからのデータを集約し、ブラウザUIダッシュボードにリアルタイムで表示。  
- **入力**: 状態整形器／結果整形器／Reward Synthesizer／思考ログからの整形済みデータストリーム。  
- **出力**: Webソケット/SSE経由の配信、UIコンポーネント向けJSON、通知イベント。  
- **備考**: 閾値設定やフィルタリングの変更を双方向で受け付け、他エージェントへフィードバックする。

## 8. Safety Sentinel (任意導入)

- **役割**: LLM出力や実行結果を監視し、危険行動や倫理的に不適切な操作をブロック。  
- **入力**: LLMプラン、実行ログ、環境からの危険アラート。  
- **出力**: ブロック指示、警告メッセージ、必要に応じたフォールバックプラン。  
- **備考**: 将来的には別LLMまたはルールベースエージェントとして実装。

## 9. Playground Custodian (任意導入)

- **役割**: `playground/` 内で生成されたスクリプト・メモ・試験ログを整理し、本体システムへ取り込むかどうかを判断する。  
- **入力**: Playground内ファイルイベント、LLMからのメタノート、ダッシュボード経由の公開設定。  
- **出力**: 重要成果の昇格リクエスト、不要ファイルの整理提案、ダッシュボード共有メタデータ。  
- **備考**: 自動化しない場合は人間監督が担当し、Safety Sentinelと連携して危険操作を検査する。

## エージェント間のインターフェース

- すべてのエージェント間通信は構造化データ（JSONまたはCSVライク）＋短い自然言語メモで統一。  
- 行動列は `action_id`, `parameters`, `confidence`, `risk_estimate` を最低限含む。  
- 記憶アクセスは `query -> response` のRPC風プロトコルを想定し、返却データにメタ情報（生成日時、信頼度）を付与。

## 拡張案

- マルチLLM化: 計画/反省/安全監視を専門エージェントに分割し、協調対話で意思決定する。  
- モデル学習の統合: アクション履歴を使い、補助的なRLポリシーが自動で候補アクションを提案。  
- 可視化ダッシュボード: エージェント間メッセージをタイムライン表示し、恐怖・好奇心の変化をトラッキング。
